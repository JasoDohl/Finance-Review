<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Finance Review Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .fade-in { animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .hidden { display: none; }
        .active-nav { background-color: #e0e7ff; color: #4338ca; border-right: 4px solid #4338ca; }
    </style>
</head>
<body class="bg-slate-100 min-h-screen font-sans text-slate-900">

    <div class="flex flex-col md:flex-row min-h-screen">
        
        <!-- Sidebar Navigation -->
        <aside class="w-full md:w-64 bg-white shadow-md z-10 flex flex-col">
            <div class="p-6 border-b">
                <h2 class="text-xl font-bold text-indigo-700">Review Hub</h2>
                <p class="text-xs text-slate-500 uppercase font-bold mt-1">Personal Finance</p>
            </div>
            
            <!-- User Profile Section -->
            <div id="user-section" class="p-4 bg-indigo-50 border-b border-indigo-100">
                <div id="login-ui">
                    <button id="login-btn" class="w-full bg-white text-indigo-600 font-bold py-2 px-4 rounded border border-indigo-200 hover:bg-indigo-50 transition shadow-sm flex items-center justify-center gap-2">
                        <svg class="w-4 h-4" viewBox="0 0 24 24"><path fill="currentColor" d="M21.35 11.1h-9.17v2.98h5.24c-.23 1.2-1.9 3.54-5.24 3.54c-3.15 0-5.73-2.61-5.73-5.8s2.58-5.8 5.73-5.8c1.37 0 2.66.47 3.66 1.4l2.25-2.25C16.48 3.8 14.51 3 12.18 3C7.11 3 3 7.11 3 12.18s4.11 9.18 9.18 9.18c5.29 0 8.81-3.72 8.81-8.96c0-.6-.07-1.18-.15-1.74z"/></svg>
                        Sign in with Google
                    </button>
                    <p class="text-[10px] text-center text-slate-500 mt-2">Sign in to save progress to the cloud</p>
                </div>
                <div id="user-info" class="hidden">
                    <div class="flex items-center gap-3">
                        <img id="user-photo" src="" alt="User" class="w-8 h-8 rounded-full bg-indigo-200">
                        <div class="overflow-hidden">
                            <p id="user-name" class="text-sm font-bold text-indigo-900 truncate">Student Name</p>
                            <button id="logout-btn" class="text-xs text-indigo-500 hover:text-indigo-700 underline">Sign Out</button>
                        </div>
                    </div>
                </div>
            </div>

            <nav class="mt-4 flex-1">
                <button onclick="window.app.showPage('home')" id="nav-home" class="w-full flex items-center px-6 py-4 text-left hover:bg-slate-50 transition active-nav">
                    <span class="mr-3">üè†</span> Home Dashboard
                </button>
                <button onclick="window.app.showPage('ch1')" id="nav-ch1" class="w-full flex items-center px-6 py-4 text-left hover:bg-slate-50 transition">
                    <span class="mr-3">üîë</span> Ch 1: Making Decisions
                </button>
                <button onclick="window.app.showPage('ch2')" id="nav-ch2" class="w-full flex items-center px-6 py-4 text-left hover:bg-slate-50 transition text-slate-400 cursor-not-allowed">
                    <span class="mr-3">üìä</span> Ch 2: (Coming Soon)
                </button>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 p-4 md:p-10 relative">
            
            <!-- Config Warning Overlay -->
            <div id="config-warning" class="hidden absolute inset-0 bg-white/90 z-50 flex items-center justify-center backdrop-blur-sm">
                <div class="bg-white p-8 rounded-2xl shadow-2xl border-2 border-red-100 max-w-lg text-center">
                    <h2 class="text-2xl font-bold text-red-600 mb-2">‚ö†Ô∏è Configuration Needed</h2>
                    <p class="text-slate-600 mb-4">You need to paste your Firebase Keys into the code.</p>
                    <p class="text-xs text-slate-400 bg-slate-100 p-2 rounded">Open index.html and look for lines 300-307.</p>
                    <button onclick="document.getElementById('config-warning').classList.add('hidden')" class="mt-4 text-indigo-600 underline text-sm">Continue using Local Storage for now</button>
                </div>
            </div>

            <!-- Notes Modal (Cheat Sheet) -->
            <div id="notes-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
                <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[85vh] overflow-y-auto">
                    <div class="p-6 border-b flex justify-between items-center sticky top-0 bg-white">
                        <h3 class="text-xl font-bold text-indigo-800">Chapter 1 Review Notes</h3>
                        <button onclick="document.getElementById('notes-modal').classList.add('hidden')" class="text-slate-400 hover:text-slate-600 font-bold text-xl">‚úï</button>
                    </div>
                    <div class="p-6 text-sm text-slate-700 space-y-6">
                        <!-- Section 1 -->
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-bold text-blue-900 mb-2">The Process & Influences</h4>
                            <ul class="list-disc pl-5 space-y-1">
                                <li><strong>5 Steps:</strong> Identify Problem ‚Üí Gather Info ‚Üí Consequences ‚Üí Action ‚Üí Evaluate.</li>
                                <li><strong>Economic Influences:</strong> Interest Rates, Inflation, Unemployment, GDP.</li>
                                <li><strong>Personal Influences:</strong> Age, Values, Family, Peers.</li>
                                <li><strong>6 Specific Factors:</strong> Values, Peers, Habits, Feelings, Family, Risks/Consequences.</li>
                            </ul>
                        </div>
                        <!-- Section 2 -->
                        <div class="bg-green-50 p-4 rounded-lg">
                            <h4 class="font-bold text-green-900 mb-2">Money & Economy</h4>
                            <ul class="list-disc pl-5 space-y-1">
                                <li><strong>Interest Rates:</strong> High rates = Less borrowing, More saving. Low rates = More spending.</li>
                                <li><strong>GDP:</strong> Total value of goods/services produced in the country.</li>
                                <li><strong>Consumer Spending:</strong> Rises when employment is high and interest rates are low.</li>
                            </ul>
                        </div>
                        <!-- Section 3 -->
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <h4 class="font-bold text-purple-900 mb-2">Risks & Costs</h4>
                            <ul class="list-disc pl-5 space-y-1">
                                <li><strong>Opportunity Cost:</strong> What you give up when making a decision.</li>
                                <li><strong>Personal Opp Cost:</strong> Time, health, energy.</li>
                                <li><strong>Financial Opp Cost:</strong> Monetary value (interest lost).</li>
                                <li><strong>Time Value of Money:</strong> Calculating increases in money over time (Interest).</li>
                                <li><strong>Risks:</strong> Liquidity (Cash conversion), Inflation (Price rise), Personal (Safety).</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div id="content-area" class="max-w-4xl mx-auto">
                
                <!-- HOME DASHBOARD -->
                <section id="page-home" class="fade-in">
                    <div class="bg-white rounded-2xl shadow-sm p-8 mb-6 border border-slate-200">
                        <h1 class="text-3xl font-extrabold text-slate-800 mb-4">Welcome to the Interactive Review Hub</h1>
                        <p class="text-slate-600 leading-relaxed mb-6">
                            This site is designed to help you prepare for your chapter tests through interactive games. 
                            <span id="login-prompt" class="font-bold text-indigo-600">Sign in to save your progress!</span>
                        </p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="p-6 border rounded-xl bg-indigo-50 border-indigo-100">
                                <h3 class="font-bold text-indigo-900">Current Progress</h3>
                                <p id="completion-status" class="text-sm text-indigo-700 mt-1">Loading progress...</p>
                            </div>
                            <div class="p-6 border rounded-xl bg-slate-50 border-slate-200">
                                <h3 class="font-bold text-slate-800">Next Up</h3>
                                <p class="text-sm text-slate-600 mt-1">Complete Chapter 1: Decision Making.</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- CHAPTER 1: FULL REVIEW GAME -->
                <section id="page-ch1" class="fade-in hidden">
                    <div class="bg-white rounded-2xl shadow-xl p-8 min-h-[600px] border border-slate-200 relative">
                        
                        <!-- Header -->
                        <div class="flex justify-between items-start mb-8">
                            <div>
                                <h2 class="text-2xl font-bold text-indigo-700">Chapter 1 Review Challenge</h2>
                                <p class="text-slate-500 text-sm">10 Questions covering your Lesson Review Sheet</p>
                            </div>
                            <button onclick="document.getElementById('notes-modal').classList.remove('hidden')" class="text-xs bg-amber-100 hover:bg-amber-200 text-amber-800 px-4 py-2 rounded-full border border-amber-200 font-bold transition">
                                üìñ Open Cheat Sheet
                            </button>
                        </div>

                        <!-- Progress -->
                        <div class="w-full bg-slate-100 rounded-full h-2 mb-8">
                            <div id="ch1-progress" class="bg-indigo-600 h-2 rounded-full transition-all duration-500" style="width: 5%"></div>
                        </div>

                        <!-- Game Container -->
                        <div id="ch1-game-container">
                            
                            <!-- Q1 -->
                            <div id="ch1-q1" class="ch1-stage">
                                <span class="text-xs font-bold text-indigo-500 uppercase">Question 1 / 10</span>
                                <p class="text-xl mt-2 mb-6 font-medium">According to Review Question #3: What is the <strong>very first step</strong> in the decision-making process?</p>
                                <div class="grid gap-3">
                                    <button onclick="window.app.handleCh1(1, 'A')" class="p-4 border-2 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 text-left transition">Evaluate the results</button>
                                    <button onclick="window.app.handleCh1(1, 'B')" class="p-4 border-2 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 text-left transition">Identify the problem</button>
                                    <button onclick="window.app.handleCh1(1, 'C')" class="p-4 border-2 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 text-left transition">Gather information</button>
                                </div>
                            </div>

                            <!-- Q2 -->
                            <div id="ch1-q2" class="ch1-stage hidden">
                                <span class="text-xs font-bold text-indigo-500 uppercase">Question 2 / 10</span>
                                <p class="text-xl mt-2 mb-6 font-medium">From Review Question #6: Is <strong>Procrastination</strong> considered an Economic or Personal influence?</p>
                                <div class="grid gap-3">
                                    <button onclick="window.app.handleCh1(2, 'A')" class="p-4 border-2 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 text-left transition">Economic Influence</button>
                                    <button onclick="window.app.handleCh1(2, 'B')" class="p-4 border-2 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 text-left transition">Personal Influence</button>
                                </div>
                            </div>

                            <!-- Q3 -->
                            <div id="ch1-q3" class="ch1-stage hidden">
                                <span class="text-xs font-bold text-indigo-500 uppercase">Question 3 / 10</span>
                                <p class="text-xl mt-2 mb-6 font-medium">From Review Question #7: What does <strong>Higher Interest Rates</strong> usually result in?</p>
                                <div class="grid gap-3">
                                    <button onclick="window.app.handleCh1(3, 'A')" class="p-4 border-2 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 text-left transition">Higher consumer spending</button>
                                    <button onclick="window.app.handleCh1(3, 'B')" class="p-4 border-2 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 text-left transition">Less borrowing (money is expensive)</button>
                                    <button onclick="window.app.handleCh1(3, 'C')" class="p-4 border-2 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 text-left transition">More people buying houses</button>
                                </div>
                            </div>

                            <!-- Q4 -->
                            <div id="ch1-q4" class="ch1-stage hidden">
                                <span class="text-xs font-bold text-indigo-500 uppercase">Question 4 / 10</span>
                                <p class="text-xl mt-2 mb-6 font-medium">From Review Question #10: What does <strong>Gross Domestic Product (GDP)</strong> measure?</p>
                                <div class="grid gap-3">
                                    <button onclick="window.app.handleCh1(4, 'A')" class="p-4 border-2 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 text-left transition">The total value of goods/services produced in the country</button>
                                    <button onclick="window.app.handleCh1(4, 'B')" class="p-4 border-2 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 text-left transition">The unemployment rate</button>
                                    <button onclick="window.app.handleCh1(4, 'C')" class="p-4 border-2 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 text-left transition">Changes in the buying power of the dollar</button>
                                </div>
                            </div>

                            <!-- Q5 -->
                            <div id="ch1-q5" class="ch1-stage hidden">
                                <span class="text-xs font-bold text-indigo-500 uppercase">Question 5 / 10</span>
                                <p class="text-xl mt-2 mb-6 font-medium">From Review Question #12: Is <strong>Unemployment</strong> considered an Economic or Personal influence?</p>
                                <div class="grid gap-3">
                                    <button onclick="window.app.handleCh1(5, 'A')" class="p-4 border-2 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 text-left transition">Economic Influence</button>
                                    <button onclick="window.app.handleCh1(5, 'B')" class="p-4 border-2 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 text-left transition">Personal Influence</button>
                                </div>
                            </div>

                            <!-- Q6 -->
                            <div id="ch1-q6" class="ch1-stage hidden">
                                <span class="text-xs font-bold text-indigo-500 uppercase">Question 6 / 10</span>
                                <p class="text-xl mt-2 mb-6 font-medium">From Review Question #8: Which risk involves "difficulty converting an investment to cash quickly"?</p>
                                <div class="grid gap-3">
                                    <button onclick="window.app.handleCh1(6, 'A')" class="p-4 border-2 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 text-left transition">Inflation Risk</button>
                                    <button onclick="window.app.handleCh1(6, 'B')" class="p-4 border-2 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 text-left transition">Liquidity Risk</button>
                                    <button onclick="window.app.handleCh1(6, 'C')" class="p-4 border-2 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 text-left transition">Personal Risk</button>
                                </div>
                            </div>

                            <!-- Q7 -->
                            <div id="ch1-q7" class="ch1-stage hidden">
                                <span class="text-xs font-bold text-indigo-500 uppercase">Question 7 / 10</span>
                                <p class="text-xl mt-2 mb-6 font-medium">From Review Question #2: What is the term for "what a person gives up when making a decision"?</p>
                                <div class="grid gap-3">
                                    <button onclick="window.app.handleCh1(7, 'A')" class="p-4 border-2 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 text-left transition">Opportunity Cost</button>
                                    <button onclick="window.app.handleCh1(7, 'B')" class="p-4 border-2 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 text-left transition">Sunk Cost</button>
                                    <button onclick="window.app.handleCh1(7, 'C')" class="p-4 border-2 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 text-left transition">Liabilities</button>
                                </div>
                            </div>

                            <!-- Q8 -->
                            <div id="ch1-q8" class="ch1-stage hidden">
                                <span class="text-xs font-bold text-indigo-500 uppercase">Question 8 / 10</span>
                                <p class="text-xl mt-2 mb-6 font-medium">From Review Question #14: Which type of Opportunity Cost involves "Time, Health, or Energy"?</p>
                                <div class="grid gap-3">
                                    <button onclick="window.app.handleCh1(8, 'A')" class="p-4 border-2 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 text-left transition">Personal Opportunity Cost</button>
                                    <button onclick="window.app.handleCh1(8, 'B')" class="p-4 border-2 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 text-left transition">Financial Opportunity Cost</button>
                                </div>
                            </div>

                            <!-- Q9 -->
                            <div id="ch1-q9" class="ch1-stage hidden">
                                <span class="text-xs font-bold text-indigo-500 uppercase">Question 9 / 10</span>
                                <p class="text-xl mt-2 mb-6 font-medium">From Review Question #1: "Time Value of Money" calculations (like Interest) are used to measure:</p>
                                <div class="grid gap-3">
                                    <button onclick="window.app.handleCh1(9, 'A')" class="p-4 border-2 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 text-left transition">Financial Opportunity Costs</button>
                                    <button onclick="window.app.handleCh1(9, 'B')" class="p-4 border-2 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 text-left transition">Personal Opportunity Costs</button>
                                </div>
                            </div>

                             <!-- Q10 -->
                             <div id="ch1-q10" class="ch1-stage hidden">
                                <span class="text-xs font-bold text-indigo-500 uppercase">Question 10 / 10</span>
                                <p class="text-xl mt-2 mb-6 font-medium">From Review Question #15: Which of these is NOT one of the 6 factors that influence a decision?</p>
                                <div class="grid gap-3">
                                    <button onclick="window.app.handleCh1(10, 'A')" class="p-4 border-2 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 text-left transition">Values & Peers</button>
                                    <button onclick="window.app.handleCh1(10, 'B')" class="p-4 border-2 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 text-left transition">Habits & Feelings</button>
                                    <button onclick="window.app.handleCh1(10, 'C')" class="p-4 border-2 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 text-left transition">Weather & Traffic</button>
                                </div>
                            </div>

                            <!-- Success Screen -->
                            <div id="ch1-success" class="ch1-stage hidden text-center py-10">
                                <span class="text-6xl">üèÜ</span>
                                <h3 class="text-3xl font-bold mt-6 text-slate-800">Review Complete!</h3>
                                <p class="text-slate-500 mb-8 mt-2">You have mastered the Chapter 1 Review Sheet.</p>
                                <button onclick="window.app.showPage('home')" class="bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-3 rounded-xl font-bold transition shadow-lg">Return to Dashboard</button>
                            </div>

                            <!-- Feedback Area -->
                            <div id="ch1-feedback" class="mt-6 p-4 rounded-xl hidden text-center font-medium border-2"></div>

                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Firebase Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ============================================================
        // üî¥ TEACHER: PASTE YOUR FIREBASE CONFIG HERE
        // ============================================================
   	 const firebaseConfig = {
 	 apiKey: "AIzaSyD_Vj-V_oQOLxEfCCgerD6BanWa14PVrDY",
 	 authDomain: "financial-literacy-review.firebaseapp.com",
 	 projectId: "financial-literacy-review",
 	 storageBucket: "financial-literacy-review.firebasestorage.app",
 	 messagingSenderId: "257043610594",
 	 appId: "1:257043610594:web:8113cb60be0522a23c17bb"
	};
        // ============================================================

        let auth, db, user = null;
        let isFirebaseActive = false;
        let localCompleted = JSON.parse(localStorage.getItem('completedCh')) || [];

        // Initialize Firebase safely
        try {
            if (firebaseConfig.apiKey === "REPLACE_WITH_YOUR_API_KEY") {
                console.warn("Firebase config not set.");
                document.getElementById('config-warning').classList.remove('hidden');
            } else {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                isFirebaseActive = true;
                
                // Auth Listener
                onAuthStateChanged(auth, async (currentUser) => {
                    user = currentUser;
                    updateUIForUser();
                    if (user) {
                        await loadUserData();
                    } else {
                        updateDashboard(); 
                    }
                });
            }
        } catch (e) {
            console.error("Firebase Init Error:", e);
        }

        window.app = {
            showPage: (pageId) => {
                document.querySelectorAll('section').forEach(sec => sec.classList.add('hidden'));
                document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active-nav'));
                document.getElementById('page-' + pageId).classList.remove('hidden');
                document.getElementById('nav-' + pageId).classList.add('active-nav');
                if (pageId === 'home') updateDashboard();
            },

            handleCh1: (step, choice) => {
                const answers = { 
                    1: 'B', // Process Step 1
                    2: 'B', // Procrastination = Personal
                    3: 'B', // Higher Interest = Less borrowing
                    4: 'A', // GDP Definition
                    5: 'A', // Unemployment = Economic
                    6: 'B', // Liquidity Risk Definition
                    7: 'A', // Opp Cost Def
                    8: 'A', // Personal Opp Cost
                    9: 'A', // TVM measures Financial Opp Cost
                    10: 'C' // Not a factor
                };
                
                const hints = {
                    1: "Hint: You must know what is wrong before you can fix it.",
                    2: "Hint: Is procrastination caused by the economy (money) or your own behavior?",
                    3: "Hint: If it costs MORE to borrow money, people do it LESS.",
                    4: "Hint: GDP stands for Gross Domestic Product.",
                    5: "Hint: Unemployment affects the whole economy's spending power.",
                    6: "Hint: Liquidity is about how 'liquid' (flowy) your money is.",
                    7: "Hint: It is the cost of the 'opportunity' you missed.",
                    8: "Hint: Does this involve money? No. It involves time/energy.",
                    9: "Hint: Interest is money, so it is a Financial cost.",
                    10: "Hint: Weather/Traffic are annoyance, but not one of the 6 key factors (Values, Peers, Habits, Feelings, Family, Risks)."
                };

                const feedback = document.getElementById('ch1-feedback');
                const isCorrect = choice === answers[step];

                feedback.classList.remove('hidden', 'bg-red-50', 'text-red-700', 'bg-green-50', 'text-green-700', 'border-red-200', 'border-green-200');
                
                if (isCorrect) {
                    feedback.innerText = "Correct! ‚úÖ";
                    feedback.classList.add('bg-green-50', 'text-green-700', 'border-green-200');
                    
                    setTimeout(() => {
                        feedback.classList.add('hidden');
                        document.getElementById(`ch1-q${step}`).classList.add('hidden');
                        const next = step + 1;
                        
                        // Update Progress Bar
                        document.getElementById('ch1-progress').style.width = (next / 11 * 100) + '%';

                        if (next <= 10) {
                            document.getElementById(`ch1-q${
